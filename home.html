<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <script>
            window.addEventListener("load", function(evt) {
                var output = document.getElementById("output");
                var input = document.getElementById("input");
                var ws;
                var print = function(message) {
                    var d = document.createElement("div");
                    d.textContent = message;
                    output.appendChild(d);
                    output.scroll(0, output.scrollHeight);
                };
                document.getElementById("open").onclick = function(evt) {
                    if (ws) {
                        return false;
                    }
                    ws = new WebSocket("{{.}}");
                    ws.onopen = function(evt) {
                        print("OPEN");
                    }
                    ws.onclose = function(evt) {
                        print("CLOSE");
                        ws = null;
                    }
                    ws.onmessage = function(evt) {
                        let field = evt.data.split("=");
                        let name = field[0];
                        let value = field[1];
                        print("Field: " + name);
                        print("Value: " + value);
                    }
                    ws.onerror = function(evt) {
                        print("ERROR: " + evt.data);
                    }
                    return false;
                };

                document.getElementById("something").onclick = function(evt) {
                    if (!ws) {
                        return false;
                    }
                    let cmd = "something=" + input.value;
                    print(cmd);
                    ws.send(cmd);
                    return false;
                };

                document.getElementById("somethingElse").onclick = function(evt) {
                    if (!ws) {
                        return false;
                    }
                    let cmd = "somethingElse=" + input.value;
                    print(cmd);
                    ws.send(cmd);
                    return false;
                };

                document.getElementById("close").onclick = function(evt) {
                    if (!ws) {
                        return false;
                    }
                    ws.close();
                    return false;
                };

                document.getElementById("clear").onclick = function(evt) {
                    if (!ws) {
                        return false;
                    }
                    output.innerHTML = "";
                    return false;
                };
            });
        </script>
    </head>
    <body>
        <table>
            <tr>
                <td valign="top" width="50%">
                    <br/>
                    Click "Open" to create a connection to the server,
                    "Send" to send a message to the server and "Close" to close the connection.
                    You can change the message and send multiple times.
                    <br/>
                    <button id="open">Open</button>
                    <button id="close">Close</button>
                    <input id="input" type="text" value="Hello world!"><br/>
                    <button id="something">Something</button>
                    <button id="somethingElse">Something else</button>
                    <button id="clear">Clear</button>
                </td>
                <td valign="top" width="50%">
                    <div id="output" style="max-height: 70vh;overflow-y: scroll;"></div>
                </td>
            </tr>
        </table>
    </body>
</html>
